INFO:     Will watch for changes in these directories: ['/Users/zalelee/Code/tatake_backend']
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [42253] using WatchFiles
INFO:     Started server process [42260]
INFO:     Waiting for application startup.
🚀 TaKeKe API v1.0.0 正在启动...
📝 环境: 开发
🌐 API服务地址: http://0.0.0.0:8001
✅ 简化认证数据库表创建成功（auth + auth_audit_logs）
✅ 认证数据库初始化完成
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine SELECT 1
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,817 INFO sqlalchemy.engine.Engine COMMIT
✅ 任务数据库初始化完成
2025-10-25 01:10:25,818 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:25,820 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:10:25,820 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('小金币',)
2025-10-25 01:10:25,820 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:10:25,820 INFO sqlalchemy.engine.Engine [cached since 0.000321s ago] ('钻石',)
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('小金币合成钻石',)
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine COMMIT
✅ 奖励数据库初始化完成
✅ 聊天数据库初始化完成
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,821 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:10:25,822 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:25,822 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'test_permanent_anti_spam.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [42260]
INFO:     Started server process [42304]
INFO:     Waiting for application startup.
🚀 TaKeKe API v1.0.0 正在启动...
📝 环境: 开发
🌐 API服务地址: http://0.0.0.0:8001
✅ 简化认证数据库表创建成功（auth + auth_audit_logs）
✅ 认证数据库初始化完成
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine SELECT 1
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ()
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:10:35,542 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine COMMIT
✅ 任务数据库初始化完成
2025-10-25 01:10:35,543 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:35,545 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:10:35,545 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('小金币',)
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine [cached since 0.0003166s ago] ('钻石',)
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('小金币合成钻石',)
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine COMMIT
✅ 奖励数据库初始化完成
✅ 聊天数据库初始化完成
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,546 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:10:35,547 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
✅ Focus数据库初始化完成
✅ API服务启动完成
INFO:     127.0.0.1:53645 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:10:43,004 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,004 INFO sqlalchemy.engine.Engine INSERT INTO tasks (id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:10:43,005 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', '2025-10-24 17:10:43.004232', '2025-10-24 17:10:43.004233', 'dc93b0e9-db79-4828-a209-61a721876d3e', '永久防刷测试任务', '测试永久防刷机制', None, 'pending', 'high', 0, 0.0, None, '[]', '[]', None, None, None)
2025-10-25 01:10:43,005 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:10:43,005 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925',)
2025-10-25 01:10:43,006 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:10:43,006 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,006 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:10:43,006 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925',)
INFO:     127.0.0.1:53647 - "POST /tasks/ HTTP/1.1" 200 OK
2025-10-25 01:10:43,007 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:10:43,008 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,009 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:10:43,009 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
2025-10-25 01:10:43,009 INFO sqlalchemy.engine.Engine SELECT task_top3.id, task_top3.created_at, task_top3.updated_at, task_top3.user_id, task_top3.top_date, task_top3.task_ids, task_top3.points_consumed 
FROM task_top3 
WHERE task_top3.user_id = ? AND task_top3.top_date = ?
2025-10-25 01:10:43,009 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('dc93b0e9-db79-4828-a209-61a721876d3e', '2025-10-25')
2025-10-25 01:10:43,010 INFO sqlalchemy.engine.Engine 
                        SELECT id, status, title, last_claimed_date
                        FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:10:43,010 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
🔍 DEBUG: Task bb5f87f5-513c-4d8e-bc7c-c968ae202925 - status: pending, last_claimed_date: None
2025-10-25 01:10:43,010 INFO sqlalchemy.engine.Engine INSERT INTO points_transactions (id, updated_at, user_id, amount, source_type, source_id, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:10:43,010 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('d53e5507-9c3a-4e6c-bfb0-f4a274254db9', '2025-10-24 17:10:43.010185', 'dc93b0e9-db79-4828-a209-61a721876d3e', 2, 'task_complete', 'bb5f87f5-513c-4d8e-bc7c-c968ae202925', '2025-10-24 17:10:43.010138')
2025-10-25 01:10:43,010 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:10:43,011 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,011 INFO sqlalchemy.engine.Engine SELECT points_transactions.id AS points_transactions_id, points_transactions.updated_at AS points_transactions_updated_at, points_transactions.user_id AS points_transactions_user_id, points_transactions.amount AS points_transactions_amount, points_transactions.source_type AS points_transactions_source_type, points_transactions.source_id AS points_transactions_source_id, points_transactions.created_at AS points_transactions_created_at 
FROM points_transactions 
WHERE points_transactions.id = ?
2025-10-25 01:10:43,011 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ('d53e5507-9c3a-4e6c-bfb0-f4a274254db9',)
2025-10-25 01:10:43,011 INFO sqlalchemy.engine.Engine 
                        UPDATE tasks
                        SET status = 'completed',
                            last_claimed_date = ?,
                            updated_at = ?
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:10:43,012 INFO sqlalchemy.engine.Engine [generated in 0.00004s] (datetime.date(2025, 10, 25), datetime.datetime(2025, 10, 24, 17, 10, 43, 11916, tzinfo=datetime.timezone.utc), 'bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
2025-10-25 01:10:43,012 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:10:43,012 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
2025-10-25 01:10:43,012 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:10:43,012 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,012 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:10:43,012 INFO sqlalchemy.engine.Engine [cached since 0.003513s ago] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
INFO:     127.0.0.1:53651 - "POST /tasks/bb5f87f5-513c-4d8e-bc7c-c968ae202925/complete HTTP/1.1" 200 OK
2025-10-25 01:10:43,013 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:10:43,014 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,014 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:10:43,014 INFO sqlalchemy.engine.Engine [cached since 0.005502s ago] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
2025-10-25 01:10:43,014 INFO sqlalchemy.engine.Engine 
                    UPDATE tasks
                    SET status = 'pending', updated_at = ?
                    WHERE id = ? AND user_id = ?
                
2025-10-25 01:10:43,014 INFO sqlalchemy.engine.Engine [generated in 0.00003s] (datetime.datetime(2025, 10, 24, 17, 10, 43, 14871, tzinfo=datetime.timezone.utc), 'bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
2025-10-25 01:10:43,015 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:10:43,015 INFO sqlalchemy.engine.Engine [cached since 0.002896s ago] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
2025-10-25 01:10:43,015 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:10:43,015 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,015 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:10:43,015 INFO sqlalchemy.engine.Engine [cached since 0.006261s ago] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
INFO:     127.0.0.1:53655 - "POST /tasks/bb5f87f5-513c-4d8e-bc7c-c968ae202925/uncomplete HTTP/1.1" 200 OK
2025-10-25 01:10:43,015 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:10:43,016 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,017 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:10:43,017 INFO sqlalchemy.engine.Engine [cached since 0.007757s ago] ('bb5f87f5-513c-4d8e-bc7c-c968ae202925', 'dc93b0e9-db79-4828-a209-61a721876d3e')
INFO:     127.0.0.1:53657 - "POST /tasks/bb5f87f5-513c-4d8e-bc7c-c968ae202925/complete HTTP/1.1" 200 OK
2025-10-25 01:10:43,017 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:10:43,018 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:10:43,018 INFO sqlalchemy.engine.Engine SELECT COALESCE(SUM(amount), 0) FROM points_transactions WHERE user_id = ?
2025-10-25 01:10:43,018 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('dc93b0e9-db79-4828-a209-61a721876d3e',)
2025-10-25 01:10:43,018 INFO sqlalchemy.engine.Engine SELECT points_transactions.id, points_transactions.updated_at, points_transactions.user_id, points_transactions.amount, points_transactions.source_type, points_transactions.source_id, points_transactions.created_at 
FROM points_transactions 
WHERE points_transactions.user_id = ? ORDER BY points_transactions.created_at DESC
 LIMIT ? OFFSET ?
2025-10-25 01:10:43,018 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('dc93b0e9-db79-4828-a209-61a721876d3e', 1000, 0)
INFO:     127.0.0.1:53659 - "GET /points/balance HTTP/1.1" 200 OK
2025-10-25 01:10:43,019 INFO sqlalchemy.engine.Engine ROLLBACK
WARNING:  WatchFiles detected changes in 'comprehensive_system_test.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [42304]
INFO:     Started server process [42436]
INFO:     Waiting for application startup.
🚀 TaKeKe API v1.0.0 正在启动...
📝 环境: 开发
🌐 API服务地址: http://0.0.0.0:8001
✅ 简化认证数据库表创建成功（auth + auth_audit_logs）
✅ 认证数据库初始化完成
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine SELECT 1
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,534 INFO sqlalchemy.engine.Engine COMMIT
✅ 任务数据库初始化完成
2025-10-25 01:11:03,535 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:03,537 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:11:03,537 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('小金币',)
2025-10-25 01:11:03,537 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:11:03,537 INFO sqlalchemy.engine.Engine [cached since 0.0003268s ago] ('钻石',)
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('小金币合成钻石',)
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine COMMIT
✅ 奖励数据库初始化完成
✅ 聊天数据库初始化完成
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:11:03,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,539 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:11:03,539 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:11:03,539 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
✅ Focus数据库初始化完成
✅ API服务启动完成
INFO:     127.0.0.1:53850 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:06,256 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,256 INFO sqlalchemy.engine.Engine INSERT INTO tasks (id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:06,256 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ('7509eca6-b683-47fd-9e2b-69b981279879', '2025-10-24 17:11:06.256143', '2025-10-24 17:11:06.256144', 'ea5a3548-1246-4a6d-89a4-806cc8c99daf', '缓存测试任务', '测试缓存修复', None, 'pending', 'medium', 0, 0.0, None, '[]', '[]', None, None, None)
2025-10-25 01:11:06,257 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:06,257 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('7509eca6-b683-47fd-9e2b-69b981279879',)
2025-10-25 01:11:06,257 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,258 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,258 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:06,258 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('7509eca6-b683-47fd-9e2b-69b981279879',)
INFO:     127.0.0.1:53852 - "POST /tasks/ HTTP/1.1" 200 OK
2025-10-25 01:11:06,258 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:06,260 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,260 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,260 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('7509eca6-b683-47fd-9e2b-69b981279879', 'ea5a3548-1246-4a6d-89a4-806cc8c99daf')
2025-10-25 01:11:06,261 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,261 INFO sqlalchemy.engine.Engine [cached since 0.0003539s ago] ('7509eca6-b683-47fd-9e2b-69b981279879', 'ea5a3548-1246-4a6d-89a4-806cc8c99daf')
2025-10-25 01:11:06,261 INFO sqlalchemy.engine.Engine UPDATE tasks SET updated_at=?, title=?, status=? WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0 RETURNING id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time
2025-10-25 01:11:06,261 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('2025-10-24 17:11:06.261332', '缓存测试任务-已更新', 'in_progress', '7509eca6-b683-47fd-9e2b-69b981279879', 'ea5a3548-1246-4a6d-89a4-806cc8c99daf')
2025-10-25 01:11:06,262 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,262 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,262 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:06,262 INFO sqlalchemy.engine.Engine [cached since 0.004438s ago] ('7509eca6-b683-47fd-9e2b-69b981279879',)
/Users/zalelee/Code/tatake_backend/.venv/lib/python3.12/site-packages/pydantic/main.py:464: UserWarning: Pydantic serializer warnings:
  PydanticSerializationUnexpectedValue(Expected `str` - serialized value may not be as expected [field_name='user_id', input_value=UUID('ea5a3548-1246-4a6d-89a4-806cc8c99daf'), input_type=UUID])
  PydanticSerializationUnexpectedValue(Expected `str` - serialized value may not be as expected [field_name='id', input_value=UUID('7509eca6-b683-47fd-9e2b-69b981279879'), input_type=UUID])
  return self.__pydantic_serializer__.to_python(
INFO:     127.0.0.1:53854 - "PUT /tasks/7509eca6-b683-47fd-9e2b-69b981279879 HTTP/1.1" 200 OK
2025-10-25 01:11:06,264 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:53856 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:06,269 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,269 INFO sqlalchemy.engine.Engine INSERT INTO tasks (id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:06,270 INFO sqlalchemy.engine.Engine [cached since 0.01325s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', '2025-10-24 17:11:06.269842', '2025-10-24 17:11:06.269843', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e', '防刷测试', '测试', None, 'pending', 'medium', 0, 0.0, None, '[]', '[]', None, None, None)
2025-10-25 01:11:06,270 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:06,270 INFO sqlalchemy.engine.Engine [cached since 0.01262s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889',)
2025-10-25 01:11:06,270 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,270 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,270 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:06,270 INFO sqlalchemy.engine.Engine [cached since 0.01218s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889',)
INFO:     127.0.0.1:53858 - "POST /tasks/ HTTP/1.1" 200 OK
2025-10-25 01:11:06,270 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:06,272 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,272 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,272 INFO sqlalchemy.engine.Engine [cached since 0.01121s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
2025-10-25 01:11:06,272 INFO sqlalchemy.engine.Engine SELECT task_top3.id, task_top3.created_at, task_top3.updated_at, task_top3.user_id, task_top3.top_date, task_top3.task_ids, task_top3.points_consumed 
FROM task_top3 
WHERE task_top3.user_id = ? AND task_top3.top_date = ?
2025-10-25 01:11:06,272 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e', '2025-10-25')
2025-10-25 01:11:06,272 INFO sqlalchemy.engine.Engine 
                        SELECT id, status, title, last_claimed_date
                        FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:06,272 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
🔍 DEBUG: Task 199b343e-6e50-4944-b6ac-c0a0a5d0c889 - status: pending, last_claimed_date: None
2025-10-25 01:11:06,273 INFO sqlalchemy.engine.Engine INSERT INTO points_transactions (id, updated_at, user_id, amount, source_type, source_id, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:06,273 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('4ca431cf-5ffc-4454-b8f0-142f106c8b3e', '2025-10-24 17:11:06.272875', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e', 2, 'task_complete', '199b343e-6e50-4944-b6ac-c0a0a5d0c889', '2025-10-24 17:11:06.272837')
2025-10-25 01:11:06,273 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,273 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,273 INFO sqlalchemy.engine.Engine SELECT points_transactions.id AS points_transactions_id, points_transactions.updated_at AS points_transactions_updated_at, points_transactions.user_id AS points_transactions_user_id, points_transactions.amount AS points_transactions_amount, points_transactions.source_type AS points_transactions_source_type, points_transactions.source_id AS points_transactions_source_id, points_transactions.created_at AS points_transactions_created_at 
FROM points_transactions 
WHERE points_transactions.id = ?
2025-10-25 01:11:06,273 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('4ca431cf-5ffc-4454-b8f0-142f106c8b3e',)
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine 
                        UPDATE tasks
                        SET status = 'completed',
                            last_claimed_date = ?,
                            updated_at = ?
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine [generated in 0.00003s] (datetime.date(2025, 10, 25), datetime.datetime(2025, 10, 24, 17, 11, 6, 274057, tzinfo=datetime.timezone.utc), '199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine [generated in 0.00002s] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine [cached since 0.01372s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
INFO:     127.0.0.1:53860 - "POST /tasks/199b343e-6e50-4944-b6ac-c0a0a5d0c889/complete HTTP/1.1" 200 OK
2025-10-25 01:11:06,274 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:06,275 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,275 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,275 INFO sqlalchemy.engine.Engine [cached since 0.01508s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine 
                    UPDATE tasks
                    SET status = 'pending', updated_at = ?
                    WHERE id = ? AND user_id = ?
                
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine [generated in 0.00002s] (datetime.datetime(2025, 10, 24, 17, 11, 6, 276060, tzinfo=datetime.timezone.utc), '199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine [cached since 0.001985s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine [cached since 0.01564s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
INFO:     127.0.0.1:53862 - "POST /tasks/199b343e-6e50-4944-b6ac-c0a0a5d0c889/uncomplete HTTP/1.1" 200 OK
2025-10-25 01:11:06,276 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:06,277 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,277 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,277 INFO sqlalchemy.engine.Engine [cached since 0.01692s ago] ('199b343e-6e50-4944-b6ac-c0a0a5d0c889', 'e6b1c6bc-e00b-48ff-9d71-7fde40e3a08e')
INFO:     127.0.0.1:53864 - "POST /tasks/199b343e-6e50-4944-b6ac-c0a0a5d0c889/complete HTTP/1.1" 200 OK
2025-10-25 01:11:06,278 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:53866 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:06,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,282 INFO sqlalchemy.engine.Engine SELECT COALESCE(SUM(amount), 0) FROM points_transactions WHERE user_id = ?
2025-10-25 01:11:06,282 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('b5567ab7-5618-486e-a86c-567fc956b173',)
2025-10-25 01:11:06,283 INFO sqlalchemy.engine.Engine SELECT points_transactions.id, points_transactions.updated_at, points_transactions.user_id, points_transactions.amount, points_transactions.source_type, points_transactions.source_id, points_transactions.created_at 
FROM points_transactions 
WHERE points_transactions.user_id = ? ORDER BY points_transactions.created_at DESC
 LIMIT ? OFFSET ?
2025-10-25 01:11:06,283 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('b5567ab7-5618-486e-a86c-567fc956b173', 1000, 0)
INFO:     127.0.0.1:53868 - "GET /points/balance HTTP/1.1" 200 OK
2025-10-25 01:11:06,283 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:53870 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:06,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,287 INFO sqlalchemy.engine.Engine INSERT INTO tasks (id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:06,287 INFO sqlalchemy.engine.Engine [cached since 0.03064s ago] ('19c55473-abc8-4d47-ae1c-fc3ac6614f60', '2025-10-24 17:11:06.287224', '2025-10-24 17:11:06.287224', 'd55aac8c-f950-4113-b9cf-715292af91cf', '一致性测试', '测试', None, 'pending', 'medium', 0, 0.0, None, '[]', '[]', None, None, None)
2025-10-25 01:11:06,287 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:06,287 INFO sqlalchemy.engine.Engine [cached since 0.03003s ago] ('19c55473-abc8-4d47-ae1c-fc3ac6614f60',)
2025-10-25 01:11:06,287 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,288 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:06,288 INFO sqlalchemy.engine.Engine [cached since 0.02989s ago] ('19c55473-abc8-4d47-ae1c-fc3ac6614f60',)
INFO:     127.0.0.1:53872 - "POST /tasks/ HTTP/1.1" 200 OK
2025-10-25 01:11:06,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine [cached since 0.02866s ago] ('19c55473-abc8-4d47-ae1c-fc3ac6614f60', 'd55aac8c-f950-4113-b9cf-715292af91cf')
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine SELECT task_top3.id, task_top3.created_at, task_top3.updated_at, task_top3.user_id, task_top3.top_date, task_top3.task_ids, task_top3.points_consumed 
FROM task_top3 
WHERE task_top3.user_id = ? AND task_top3.top_date = ?
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine [cached since 0.01719s ago] ('d55aac8c-f950-4113-b9cf-715292af91cf', '2025-10-25')
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine 
                        SELECT id, status, title, last_claimed_date
                        FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine [cached since 0.01707s ago] ('19c55473-abc8-4d47-ae1c-fc3ac6614f60', 'd55aac8c-f950-4113-b9cf-715292af91cf')
🔍 DEBUG: Task 19c55473-abc8-4d47-ae1c-fc3ac6614f60 - status: pending, last_claimed_date: None
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine INSERT INTO points_transactions (id, updated_at, user_id, amount, source_type, source_id, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:06,289 INFO sqlalchemy.engine.Engine [cached since 0.01676s ago] ('b074b457-bc62-48f7-840e-3d78804971de', '2025-10-24 17:11:06.289897', 'd55aac8c-f950-4113-b9cf-715292af91cf', 2, 'task_complete', '19c55473-abc8-4d47-ae1c-fc3ac6614f60', '2025-10-24 17:11:06.289867')
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine SELECT points_transactions.id AS points_transactions_id, points_transactions.updated_at AS points_transactions_updated_at, points_transactions.user_id AS points_transactions_user_id, points_transactions.amount AS points_transactions_amount, points_transactions.source_type AS points_transactions_source_type, points_transactions.source_id AS points_transactions_source_id, points_transactions.created_at AS points_transactions_created_at 
FROM points_transactions 
WHERE points_transactions.id = ?
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine [cached since 0.01649s ago] ('b074b457-bc62-48f7-840e-3d78804971de',)
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine 
                        UPDATE tasks
                        SET status = 'completed',
                            last_claimed_date = ?,
                            updated_at = ?
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine [cached since 0.01639s ago] (datetime.date(2025, 10, 25), datetime.datetime(2025, 10, 24, 17, 11, 6, 290454, tzinfo=datetime.timezone.utc), '19c55473-abc8-4d47-ae1c-fc3ac6614f60', 'd55aac8c-f950-4113-b9cf-715292af91cf')
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine [cached since 0.01635s ago] ('19c55473-abc8-4d47-ae1c-fc3ac6614f60', 'd55aac8c-f950-4113-b9cf-715292af91cf')
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:06,290 INFO sqlalchemy.engine.Engine [cached since 0.03002s ago] ('19c55473-abc8-4d47-ae1c-fc3ac6614f60', 'd55aac8c-f950-4113-b9cf-715292af91cf')
INFO:     127.0.0.1:53874 - "POST /tasks/19c55473-abc8-4d47-ae1c-fc3ac6614f60/complete HTTP/1.1" 200 OK
2025-10-25 01:11:06,291 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:06,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:06,292 INFO sqlalchemy.engine.Engine SELECT COALESCE(SUM(amount), 0) FROM points_transactions WHERE user_id = ?
2025-10-25 01:11:06,292 INFO sqlalchemy.engine.Engine [cached since 0.009264s ago] ('d55aac8c-f950-4113-b9cf-715292af91cf',)
2025-10-25 01:11:06,292 INFO sqlalchemy.engine.Engine SELECT points_transactions.id, points_transactions.updated_at, points_transactions.user_id, points_transactions.amount, points_transactions.source_type, points_transactions.source_id, points_transactions.created_at 
FROM points_transactions 
WHERE points_transactions.user_id = ? ORDER BY points_transactions.created_at DESC
 LIMIT ? OFFSET ?
2025-10-25 01:11:06,292 INFO sqlalchemy.engine.Engine [cached since 0.008991s ago] ('d55aac8c-f950-4113-b9cf-715292af91cf', 1000, 0)
INFO:     127.0.0.1:53876 - "GET /points/balance HTTP/1.1" 200 OK
2025-10-25 01:11:06,292 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:54240 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:51,261 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,261 INFO sqlalchemy.engine.Engine INSERT INTO tasks (id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:51,261 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('c27835f2-cceb-4920-8714-2b107b3e63ff', '2025-10-24 17:11:51.261313', '2025-10-24 17:11:51.261314', '1f76f6a9-7882-4a6a-ad19-e295f5c83eaa', '缓存测试任务', '测试缓存修复', None, 'pending', 'medium', 0, 0.0, None, '[]', '[]', None, None, None)
2025-10-25 01:11:51,261 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:51,261 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('c27835f2-cceb-4920-8714-2b107b3e63ff',)
2025-10-25 01:11:51,261 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,263 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,263 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:51,263 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('c27835f2-cceb-4920-8714-2b107b3e63ff',)
INFO:     127.0.0.1:54242 - "POST /tasks/ HTTP/1.1" 200 OK
2025-10-25 01:11:51,263 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:51,264 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,264 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,264 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('c27835f2-cceb-4920-8714-2b107b3e63ff', '1f76f6a9-7882-4a6a-ad19-e295f5c83eaa')
2025-10-25 01:11:51,265 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,265 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('c27835f2-cceb-4920-8714-2b107b3e63ff', '1f76f6a9-7882-4a6a-ad19-e295f5c83eaa')
2025-10-25 01:11:51,265 INFO sqlalchemy.engine.Engine UPDATE tasks SET updated_at=?, title=?, status=? WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0 RETURNING id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time
2025-10-25 01:11:51,265 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('2025-10-24 17:11:51.265106', '缓存测试任务-已更新', 'in_progress', 'c27835f2-cceb-4920-8714-2b107b3e63ff', '1f76f6a9-7882-4a6a-ad19-e295f5c83eaa')
2025-10-25 01:11:51,265 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,265 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,265 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:51,265 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('c27835f2-cceb-4920-8714-2b107b3e63ff',)
/Users/zalelee/Code/tatake_backend/.venv/lib/python3.12/site-packages/pydantic/main.py:464: UserWarning: Pydantic serializer warnings:
  PydanticSerializationUnexpectedValue(Expected `str` - serialized value may not be as expected [field_name='user_id', input_value=UUID('1f76f6a9-7882-4a6a-ad19-e295f5c83eaa'), input_type=UUID])
  PydanticSerializationUnexpectedValue(Expected `str` - serialized value may not be as expected [field_name='id', input_value=UUID('c27835f2-cceb-4920-8714-2b107b3e63ff'), input_type=UUID])
  return self.__pydantic_serializer__.to_python(
INFO:     127.0.0.1:54244 - "PUT /tasks/c27835f2-cceb-4920-8714-2b107b3e63ff HTTP/1.1" 200 OK
2025-10-25 01:11:51,266 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:54246 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:51,270 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine INSERT INTO tasks (id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '2025-10-24 17:11:51.270871', '2025-10-24 17:11:51.270871', '26cbb195-e2cd-4e71-962d-4546db68f9e6', '防刷测试', '测试', None, 'pending', 'medium', 0, 0.0, None, '[]', '[]', None, None, None)
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754',)
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754',)
INFO:     127.0.0.1:54248 - "POST /tasks/ HTTP/1.1" 200 OK
2025-10-25 01:11:51,271 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:51,272 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine SELECT task_top3.id, task_top3.created_at, task_top3.updated_at, task_top3.user_id, task_top3.top_date, task_top3.task_ids, task_top3.points_consumed 
FROM task_top3 
WHERE task_top3.user_id = ? AND task_top3.top_date = ?
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('26cbb195-e2cd-4e71-962d-4546db68f9e6', '2025-10-25')
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine 
                        SELECT id, status, title, last_claimed_date
                        FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
🔍 DEBUG: Task c8aee840-1d39-4060-b70a-81efe2ac3754 - status: pending, last_claimed_date: None
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine INSERT INTO points_transactions (id, updated_at, user_id, amount, source_type, source_id, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('4322d4a0-449f-404c-9c7c-e412dbfaa1b3', '2025-10-24 17:11:51.273332', '26cbb195-e2cd-4e71-962d-4546db68f9e6', 2, 'task_complete', 'c8aee840-1d39-4060-b70a-81efe2ac3754', '2025-10-24 17:11:51.273303')
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine SELECT points_transactions.id AS points_transactions_id, points_transactions.updated_at AS points_transactions_updated_at, points_transactions.user_id AS points_transactions_user_id, points_transactions.amount AS points_transactions_amount, points_transactions.source_type AS points_transactions_source_type, points_transactions.source_id AS points_transactions_source_id, points_transactions.created_at AS points_transactions_created_at 
FROM points_transactions 
WHERE points_transactions.id = ?
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('4322d4a0-449f-404c-9c7c-e412dbfaa1b3',)
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine 
                        UPDATE tasks
                        SET status = 'completed',
                            last_claimed_date = ?,
                            updated_at = ?
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:51,273 INFO sqlalchemy.engine.Engine [cached since 45s ago] (datetime.date(2025, 10, 25), datetime.datetime(2025, 10, 24, 17, 11, 51, 273911, tzinfo=datetime.timezone.utc), 'c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
2025-10-25 01:11:51,274 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:51,274 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
2025-10-25 01:11:51,274 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,274 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,274 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,274 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
INFO:     127.0.0.1:54250 - "POST /tasks/c8aee840-1d39-4060-b70a-81efe2ac3754/complete HTTP/1.1" 200 OK
2025-10-25 01:11:51,274 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:51,275 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,275 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,275 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
2025-10-25 01:11:51,275 INFO sqlalchemy.engine.Engine 
                    UPDATE tasks
                    SET status = 'pending', updated_at = ?
                    WHERE id = ? AND user_id = ?
                
2025-10-25 01:11:51,275 INFO sqlalchemy.engine.Engine [cached since 45s ago] (datetime.datetime(2025, 10, 24, 17, 11, 51, 275802, tzinfo=datetime.timezone.utc), 'c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
2025-10-25 01:11:51,275 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:51,275 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
2025-10-25 01:11:51,276 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,276 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,276 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,276 INFO sqlalchemy.engine.Engine [cached since 45.02s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
INFO:     127.0.0.1:54252 - "POST /tasks/c8aee840-1d39-4060-b70a-81efe2ac3754/uncomplete HTTP/1.1" 200 OK
2025-10-25 01:11:51,276 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:51,277 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,277 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,277 INFO sqlalchemy.engine.Engine [cached since 45.02s ago] ('c8aee840-1d39-4060-b70a-81efe2ac3754', '26cbb195-e2cd-4e71-962d-4546db68f9e6')
INFO:     127.0.0.1:54254 - "POST /tasks/c8aee840-1d39-4060-b70a-81efe2ac3754/complete HTTP/1.1" 200 OK
2025-10-25 01:11:51,277 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:54256 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:51,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,281 INFO sqlalchemy.engine.Engine SELECT COALESCE(SUM(amount), 0) FROM points_transactions WHERE user_id = ?
2025-10-25 01:11:51,281 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('57056254-fdae-4fb3-9297-01f430476bd6',)
2025-10-25 01:11:51,281 INFO sqlalchemy.engine.Engine SELECT points_transactions.id, points_transactions.updated_at, points_transactions.user_id, points_transactions.amount, points_transactions.source_type, points_transactions.source_id, points_transactions.created_at 
FROM points_transactions 
WHERE points_transactions.user_id = ? ORDER BY points_transactions.created_at DESC
 LIMIT ? OFFSET ?
2025-10-25 01:11:51,281 INFO sqlalchemy.engine.Engine [cached since 45s ago] ('57056254-fdae-4fb3-9297-01f430476bd6', 1000, 0)
INFO:     127.0.0.1:54258 - "GET /points/balance HTTP/1.1" 200 OK
2025-10-25 01:11:51,281 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:54260 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine INSERT INTO tasks (id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine [cached since 45.03s ago] ('bf829802-2a3d-4c7a-b963-b00856dc21ae', '2025-10-24 17:11:51.286084', '2025-10-24 17:11:51.286084', '3d7fc5de-234b-4006-8b06-8305278034a4', '一致性测试', '测试', None, 'pending', 'medium', 0, 0.0, None, '[]', '[]', None, None, None)
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine [cached since 45.03s ago] ('bf829802-2a3d-4c7a-b963-b00856dc21ae',)
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:51,286 INFO sqlalchemy.engine.Engine [cached since 45.03s ago] ('bf829802-2a3d-4c7a-b963-b00856dc21ae',)
INFO:     127.0.0.1:54262 - "POST /tasks/ HTTP/1.1" 200 OK
2025-10-25 01:11:51,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:51,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine [cached since 45.03s ago] ('bf829802-2a3d-4c7a-b963-b00856dc21ae', '3d7fc5de-234b-4006-8b06-8305278034a4')
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine SELECT task_top3.id, task_top3.created_at, task_top3.updated_at, task_top3.user_id, task_top3.top_date, task_top3.task_ids, task_top3.points_consumed 
FROM task_top3 
WHERE task_top3.user_id = ? AND task_top3.top_date = ?
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine [cached since 45.02s ago] ('3d7fc5de-234b-4006-8b06-8305278034a4', '2025-10-25')
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine 
                        SELECT id, status, title, last_claimed_date
                        FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine [cached since 45.02s ago] ('bf829802-2a3d-4c7a-b963-b00856dc21ae', '3d7fc5de-234b-4006-8b06-8305278034a4')
🔍 DEBUG: Task bf829802-2a3d-4c7a-b963-b00856dc21ae - status: pending, last_claimed_date: None
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine INSERT INTO points_transactions (id, updated_at, user_id, amount, source_type, source_id, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine [cached since 45.02s ago] ('900da717-ec0e-4783-921d-146d75b2d2c7', '2025-10-24 17:11:51.288349', '3d7fc5de-234b-4006-8b06-8305278034a4', 2, 'task_complete', 'bf829802-2a3d-4c7a-b963-b00856dc21ae', '2025-10-24 17:11:51.288319')
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine SELECT points_transactions.id AS points_transactions_id, points_transactions.updated_at AS points_transactions_updated_at, points_transactions.user_id AS points_transactions_user_id, points_transactions.amount AS points_transactions_amount, points_transactions.source_type AS points_transactions_source_type, points_transactions.source_id AS points_transactions_source_id, points_transactions.created_at AS points_transactions_created_at 
FROM points_transactions 
WHERE points_transactions.id = ?
2025-10-25 01:11:51,288 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('900da717-ec0e-4783-921d-146d75b2d2c7',)
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine 
                        UPDATE tasks
                        SET status = 'completed',
                            last_claimed_date = ?,
                            updated_at = ?
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] (datetime.date(2025, 10, 25), datetime.datetime(2025, 10, 24, 17, 11, 51, 289018, tzinfo=datetime.timezone.utc), 'bf829802-2a3d-4c7a-b963-b00856dc21ae', '3d7fc5de-234b-4006-8b06-8305278034a4')
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('bf829802-2a3d-4c7a-b963-b00856dc21ae', '3d7fc5de-234b-4006-8b06-8305278034a4')
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine [cached since 45.03s ago] ('bf829802-2a3d-4c7a-b963-b00856dc21ae', '3d7fc5de-234b-4006-8b06-8305278034a4')
INFO:     127.0.0.1:54264 - "POST /tasks/bf829802-2a3d-4c7a-b963-b00856dc21ae/complete HTTP/1.1" 200 OK
2025-10-25 01:11:51,289 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:51,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:51,290 INFO sqlalchemy.engine.Engine SELECT COALESCE(SUM(amount), 0) FROM points_transactions WHERE user_id = ?
2025-10-25 01:11:51,290 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('3d7fc5de-234b-4006-8b06-8305278034a4',)
2025-10-25 01:11:51,290 INFO sqlalchemy.engine.Engine SELECT points_transactions.id, points_transactions.updated_at, points_transactions.user_id, points_transactions.amount, points_transactions.source_type, points_transactions.source_id, points_transactions.created_at 
FROM points_transactions 
WHERE points_transactions.user_id = ? ORDER BY points_transactions.created_at DESC
 LIMIT ? OFFSET ?
2025-10-25 01:11:51,290 INFO sqlalchemy.engine.Engine [cached since 45.01s ago] ('3d7fc5de-234b-4006-8b06-8305278034a4', 1000, 0)
INFO:     127.0.0.1:54266 - "GET /points/balance HTTP/1.1" 200 OK
2025-10-25 01:11:51,290 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:54365 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:11:53,891 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,891 INFO sqlalchemy.engine.Engine INSERT INTO tasks (id, created_at, updated_at, user_id, title, description, parent_id, status, priority, is_deleted, completion_percentage, last_claimed_date, tags, service_ids, due_date, planned_start_time, planned_end_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:53,891 INFO sqlalchemy.engine.Engine [cached since 47.63s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '2025-10-24 17:11:53.891061', '2025-10-24 17:11:53.891061', '81cb4741-70e0-45b9-8417-a73288addd6c', '永久防刷测试任务', '测试永久防刷机制', None, 'pending', 'high', 0, 0.0, None, '[]', '[]', None, None, None)
2025-10-25 01:11:53,891 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:53,891 INFO sqlalchemy.engine.Engine [cached since 47.63s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2',)
2025-10-25 01:11:53,891 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:53,892 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,892 INFO sqlalchemy.engine.Engine SELECT tasks.id AS tasks_id, tasks.created_at AS tasks_created_at, tasks.updated_at AS tasks_updated_at, tasks.user_id AS tasks_user_id, tasks.title AS tasks_title, tasks.description AS tasks_description, tasks.parent_id AS tasks_parent_id, tasks.status AS tasks_status, tasks.priority AS tasks_priority, tasks.is_deleted AS tasks_is_deleted, tasks.completion_percentage AS tasks_completion_percentage, tasks.last_claimed_date AS tasks_last_claimed_date, tasks.tags AS tasks_tags, tasks.service_ids AS tasks_service_ids, tasks.due_date AS tasks_due_date, tasks.planned_start_time AS tasks_planned_start_time, tasks.planned_end_time AS tasks_planned_end_time 
FROM tasks 
WHERE tasks.id = ?
2025-10-25 01:11:53,892 INFO sqlalchemy.engine.Engine [cached since 47.63s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2',)
INFO:     127.0.0.1:54367 - "POST /tasks/ HTTP/1.1" 200 OK
2025-10-25 01:11:53,892 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:53,893 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,893 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:53,893 INFO sqlalchemy.engine.Engine [cached since 47.63s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
2025-10-25 01:11:53,894 INFO sqlalchemy.engine.Engine SELECT task_top3.id, task_top3.created_at, task_top3.updated_at, task_top3.user_id, task_top3.top_date, task_top3.task_ids, task_top3.points_consumed 
FROM task_top3 
WHERE task_top3.user_id = ? AND task_top3.top_date = ?
2025-10-25 01:11:53,894 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] ('81cb4741-70e0-45b9-8417-a73288addd6c', '2025-10-25')
2025-10-25 01:11:53,894 INFO sqlalchemy.engine.Engine 
                        SELECT id, status, title, last_claimed_date
                        FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:53,894 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
🔍 DEBUG: Task 6f7c61b9-9e35-4f7b-8d38-099419e3cea2 - status: pending, last_claimed_date: None
2025-10-25 01:11:53,894 INFO sqlalchemy.engine.Engine INSERT INTO points_transactions (id, updated_at, user_id, amount, source_type, source_id, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-25 01:11:53,894 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] ('b53f7103-5f42-454d-bd8b-00267af4acd4', '2025-10-24 17:11:53.894280', '81cb4741-70e0-45b9-8417-a73288addd6c', 2, 'task_complete', '6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '2025-10-24 17:11:53.894241')
2025-10-25 01:11:53,894 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine SELECT points_transactions.id AS points_transactions_id, points_transactions.updated_at AS points_transactions_updated_at, points_transactions.user_id AS points_transactions_user_id, points_transactions.amount AS points_transactions_amount, points_transactions.source_type AS points_transactions_source_type, points_transactions.source_id AS points_transactions_source_id, points_transactions.created_at AS points_transactions_created_at 
FROM points_transactions 
WHERE points_transactions.id = ?
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] ('b53f7103-5f42-454d-bd8b-00267af4acd4',)
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine 
                        UPDATE tasks
                        SET status = 'completed',
                            last_claimed_date = ?,
                            updated_at = ?
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] (datetime.date(2025, 10, 25), datetime.datetime(2025, 10, 24, 17, 11, 53, 895207, tzinfo=datetime.timezone.utc), '6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:53,895 INFO sqlalchemy.engine.Engine [cached since 47.63s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
INFO:     127.0.0.1:54369 - "POST /tasks/6f7c61b9-9e35-4f7b-8d38-099419e3cea2/complete HTTP/1.1" 200 OK
2025-10-25 01:11:53,896 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:53,897 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,897 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:53,897 INFO sqlalchemy.engine.Engine [cached since 47.64s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
2025-10-25 01:11:53,897 INFO sqlalchemy.engine.Engine 
                    UPDATE tasks
                    SET status = 'pending', updated_at = ?
                    WHERE id = ? AND user_id = ?
                
2025-10-25 01:11:53,897 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] (datetime.datetime(2025, 10, 24, 17, 11, 53, 897763, tzinfo=datetime.timezone.utc), '6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
2025-10-25 01:11:53,897 INFO sqlalchemy.engine.Engine 
                        SELECT parent_id FROM tasks
                        WHERE id = ? AND user_id = ?
                    
2025-10-25 01:11:53,897 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
2025-10-25 01:11:53,897 INFO sqlalchemy.engine.Engine COMMIT
2025-10-25 01:11:53,898 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,898 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:53,898 INFO sqlalchemy.engine.Engine [cached since 47.64s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
INFO:     127.0.0.1:54371 - "POST /tasks/6f7c61b9-9e35-4f7b-8d38-099419e3cea2/uncomplete HTTP/1.1" 200 OK
2025-10-25 01:11:53,898 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:53,899 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,905 INFO sqlalchemy.engine.Engine SELECT tasks.id, tasks.created_at, tasks.updated_at, tasks.user_id, tasks.title, tasks.description, tasks.parent_id, tasks.status, tasks.priority, tasks.is_deleted, tasks.completion_percentage, tasks.last_claimed_date, tasks.tags, tasks.service_ids, tasks.due_date, tasks.planned_start_time, tasks.planned_end_time 
FROM tasks 
WHERE tasks.id = ? AND tasks.user_id = ? AND tasks.is_deleted = 0
2025-10-25 01:11:53,905 INFO sqlalchemy.engine.Engine [cached since 47.64s ago] ('6f7c61b9-9e35-4f7b-8d38-099419e3cea2', '81cb4741-70e0-45b9-8417-a73288addd6c')
INFO:     127.0.0.1:54373 - "POST /tasks/6f7c61b9-9e35-4f7b-8d38-099419e3cea2/complete HTTP/1.1" 200 OK
2025-10-25 01:11:53,905 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:11:53,906 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:11:53,906 INFO sqlalchemy.engine.Engine SELECT COALESCE(SUM(amount), 0) FROM points_transactions WHERE user_id = ?
2025-10-25 01:11:53,906 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] ('81cb4741-70e0-45b9-8417-a73288addd6c',)
2025-10-25 01:11:53,906 INFO sqlalchemy.engine.Engine SELECT points_transactions.id, points_transactions.updated_at, points_transactions.user_id, points_transactions.amount, points_transactions.source_type, points_transactions.source_id, points_transactions.created_at 
FROM points_transactions 
WHERE points_transactions.user_id = ? ORDER BY points_transactions.created_at DESC
 LIMIT ? OFFSET ?
2025-10-25 01:11:53,906 INFO sqlalchemy.engine.Engine [cached since 47.62s ago] ('81cb4741-70e0-45b9-8417-a73288addd6c', 1000, 0)
INFO:     127.0.0.1:54375 - "GET /points/balance HTTP/1.1" 200 OK
2025-10-25 01:11:53,907 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:54526 - "POST /auth/register HTTP/1.1" 200 OK
2025-10-25 01:12:00,328 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:12:00,328 INFO sqlalchemy.engine.Engine SELECT COALESCE(SUM(amount), 0) FROM points_transactions WHERE user_id = ?
2025-10-25 01:12:00,328 INFO sqlalchemy.engine.Engine [cached since 54.05s ago] ('4f5a158f-60a8-4513-b66f-be63446574e9',)
2025-10-25 01:12:00,328 INFO sqlalchemy.engine.Engine SELECT points_transactions.id, points_transactions.updated_at, points_transactions.user_id, points_transactions.amount, points_transactions.source_type, points_transactions.source_id, points_transactions.created_at 
FROM points_transactions 
WHERE points_transactions.user_id = ? ORDER BY points_transactions.created_at DESC
 LIMIT ? OFFSET ?
2025-10-25 01:12:00,328 INFO sqlalchemy.engine.Engine [cached since 54.05s ago] ('4f5a158f-60a8-4513-b66f-be63446574e9', 1000, 0)
INFO:     127.0.0.1:54592 - "GET /points/balance HTTP/1.1" 200 OK
2025-10-25 01:12:00,328 INFO sqlalchemy.engine.Engine ROLLBACK
WARNING:  WatchFiles detected changes in 'tests/system/__init__.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [42436]
INFO:     Started server process [43439]
INFO:     Waiting for application startup.
🚀 TaKeKe API v1.0.0 正在启动...
📝 环境: 开发
🌐 API服务地址: http://0.0.0.0:8001
✅ 简化认证数据库表创建成功（auth + auth_audit_logs）
✅ 认证数据库初始化完成
2025-10-25 01:14:46,854 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:46,854 INFO sqlalchemy.engine.Engine SELECT 1
2025-10-25 01:14:46,854 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
2025-10-25 01:14:46,854 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:14:46,854 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:46,854 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:14:46,854 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,855 INFO sqlalchemy.engine.Engine COMMIT
✅ 任务数据库初始化完成
2025-10-25 01:14:46,856 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:46,858 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:14:46,858 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('小金币',)
2025-10-25 01:14:46,858 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:14:46,858 INFO sqlalchemy.engine.Engine [cached since 0.0003652s ago] ('钻石',)
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('小金币合成钻石',)
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine COMMIT
✅ 奖励数据库初始化完成
✅ 聊天数据库初始化完成
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:14:46,859 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,860 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:14:46,860 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,860 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:14:46,860 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:46,860 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'tests/system/conftest.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [43439]
INFO:     Started server process [43472]
INFO:     Waiting for application startup.
🚀 TaKeKe API v1.0.0 正在启动...
📝 环境: 开发
🌐 API服务地址: http://0.0.0.0:8001
✅ 简化认证数据库表创建成功（auth + auth_audit_logs）
✅ 认证数据库初始化完成
2025-10-25 01:14:52,829 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:52,829 INFO sqlalchemy.engine.Engine SELECT 1
2025-10-25 01:14:52,829 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,830 INFO sqlalchemy.engine.Engine COMMIT
✅ 任务数据库初始化完成
2025-10-25 01:14:52,831 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:52,833 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:14:52,833 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('小金币',)
2025-10-25 01:14:52,833 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:14:52,833 INFO sqlalchemy.engine.Engine [cached since 0.0003233s ago] ('钻石',)
2025-10-25 01:14:52,833 INFO sqlalchemy.engine.Engine SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-25 01:14:52,833 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('小金币合成钻石',)
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine COMMIT
✅ 奖励数据库初始化完成
✅ 聊天数据库初始化完成
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:52,834 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'tests/system/tests/test_task_cache_fix.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [43472]
INFO:     Started server process [43513]
INFO:     Waiting for application startup.
🚀 TaKeKe API v1.0.0 正在启动...
📝 环境: 开发
🌐 API服务地址: http://0.0.0.0:8001
✅ 简化认证数据库表创建成功（auth + auth_audit_logs）
✅ 认证数据库初始化完成
2025-10-25 01:14:58,588 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:58,588 INFO sqlalchemy.engine.Engine SELECT 1
2025-10-25 01:14:58,588 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine COMMIT
✅ 任务数据库初始化完成
2025-10-25 01:14:58,589 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:58,592 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:14:58,592 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('小金币',)
2025-10-25 01:14:58,592 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:14:58,592 INFO sqlalchemy.engine.Engine [cached since 0.0003255s ago] ('钻石',)
2025-10-25 01:14:58,592 INFO sqlalchemy.engine.Engine SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-25 01:14:58,592 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('小金币合成钻石',)
2025-10-25 01:14:58,592 INFO sqlalchemy.engine.Engine COMMIT
✅ 奖励数据库初始化完成
✅ 聊天数据库初始化完成
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:14:58,593 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'tests/system/tests/test_permanent_anti_spam.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [43513]
INFO:     Started server process [43619]
INFO:     Waiting for application startup.
🚀 TaKeKe API v1.0.0 正在启动...
📝 环境: 开发
🌐 API服务地址: http://0.0.0.0:8001
✅ 简化认证数据库表创建成功（auth + auth_audit_logs）
✅ 认证数据库初始化完成
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine SELECT 1
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:15:05,654 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine COMMIT
✅ 任务数据库初始化完成
2025-10-25 01:15:05,655 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:15:05,657 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:15:05,657 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('小金币',)
2025-10-25 01:15:05,658 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:15:05,658 INFO sqlalchemy.engine.Engine [cached since 0.0003163s ago] ('钻石',)
2025-10-25 01:15:05,658 INFO sqlalchemy.engine.Engine SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-25 01:15:05,658 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('小金币合成钻石',)
2025-10-25 01:15:05,658 INFO sqlalchemy.engine.Engine COMMIT
✅ 奖励数据库初始化完成
✅ 聊天数据库初始化完成
2025-10-25 01:15:05,658 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:05,659 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'tests/system/tests/test_api_response_format.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [43619]
INFO:     Started server process [43769]
INFO:     Waiting for application startup.
🚀 TaKeKe API v1.0.0 正在启动...
📝 环境: 开发
🌐 API服务地址: http://0.0.0.0:8001
✅ 简化认证数据库表创建成功（auth + auth_audit_logs）
✅ 认证数据库初始化完成
2025-10-25 01:15:11,913 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:15:11,913 INFO sqlalchemy.engine.Engine SELECT 1
2025-10-25 01:15:11,913 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine COMMIT
✅ 任务数据库初始化完成
2025-10-25 01:15:11,914 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:15:11,917 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:15:11,917 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('小金币',)
2025-10-25 01:15:11,917 INFO sqlalchemy.engine.Engine SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-25 01:15:11,917 INFO sqlalchemy.engine.Engine [cached since 0.0003153s ago] ('钻石',)
2025-10-25 01:15:11,917 INFO sqlalchemy.engine.Engine SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-25 01:15:11,917 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ('小金币合成钻石',)
2025-10-25 01:15:11,917 INFO sqlalchemy.engine.Engine COMMIT
✅ 奖励数据库初始化完成
✅ 聊天数据库初始化完成
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("auth_audit_logs")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("tasks")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("points_transactions")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("rewards")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_recipes")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("reward_transactions")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("task_top3")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("focus_sessions")
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-10-25 01:15:11,918 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [43769]
INFO:     Stopping reloader process [42253]
