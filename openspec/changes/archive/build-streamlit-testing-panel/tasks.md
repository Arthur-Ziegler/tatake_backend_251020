# Tasks: Streamlit API 测试面板实施

## 阶段 1：基础架构（P0，顺序执行）

### 1.1 搭建项目结构
- [ ] 创建 `streamlit_app/` 目录
- [ ] 创建基础文件：`main.py`, `config.py`, `api_client.py`, `state_manager.py`
- [ ] 创建 `pages/` 和 `components/` 子目录
- [ ] 添加 Streamlit 依赖：`uv add streamlit>=1.28.0`

**验证**：运行 `uv run streamlit run streamlit_app/main.py`，显示空白主页

---

### 1.2 实现 API 客户端和状态管理
- [ ] 编写 `api_client.py`：封装 `requests`，自动注入 Token
- [ ] 编写 `state_manager.py`：初始化 `session_state` 默认值
- [ ] 实现 Token 失效自动提示（检测 401 错误）

**验证**：手动调用 `api_client.get("/health")`，返回 API 响应

---

## 阶段 2：核心页面（P0，可并行）

### 2.1 认证系统页面
- [ ] 创建 `pages/1_🏠_认证.py`
- [ ] 实现游客初始化按钮 → 存储 Token 和 User ID
- [ ] 实现刷新 Token 按钮
- [ ] 显示当前认证状态（User ID、Token 前缀、过期时间）

**验证**：点击"游客初始化"，成功获取 Token，其他页面调用 API 不报 401

---

### 2.2 任务管理页面（数据驱动）
- [ ] 创建 `pages/2_📋_任务管理.py`
- [ ] 实现任务列表加载（调用 `GET /tasks`）
- [ ] 创建 `components/task_tree.py`：递归渲染树形视图
- [ ] 每行添加操作按钮：完成、取消完成、删除
- [ ] 实现"快速创建测试任务"按钮（预设模板）
- [ ] 实现"创建任务"表单（包含高级选项折叠）
- [ ] 添加"展开查看完整 JSON"按钮

**验证**：
1. 点击"快速创建"，任务列表自动刷新
2. 点击任务的"完成"按钮，状态更新
3. 子任务正确缩进显示

---

### 2.3 智能聊天页面（类微信界面）
- [ ] 创建 `pages/3_💬_智能聊天.py`
- [ ] 创建 `components/chat_interface.py`
- [ ] 左侧显示会话列表（调用 `GET /chat/sessions`）
- [ ] 实现"创建会话"按钮
- [ ] 右侧实现聊天界面：消息历史 + 输入框 + 发送按钮
- [ ] 实现会话切换功能

**验证**：
1. 创建会话，左侧列表出现新会话
2. 发送消息，右侧显示"你: xxx"和"AI: xxx"
3. 切换会话，聊天记录正确切换

---

## 阶段 3：业务页面（P1，可并行）

### 3.1 番茄钟系统页面
- [ ] 创建 `pages/4_🍅_番茄钟.py`
- [ ] 创建 `components/focus_status.py`：显示当前会话状态
- [ ] 实现"开始专注"（下拉选择任务）
- [ ] 实现"暂停"、"恢复"、"完成"按钮
- [ ] 显示历史专注记录（调用 `GET /focus/sessions`）

**验证**：开始专注 → 暂停 → 恢复 → 完成，状态流转正确

---

### 3.2 奖励系统页面
- [ ] 创建 `pages/5_🎁_奖励系统.py`
- [ ] 标签 1：奖品目录（表格 + 兑换按钮）
- [ ] 标签 2：我的奖品（调用 `GET /rewards/my-rewards`）
- [ ] 标签 3：我的材料（调用 `GET /rewards/materials`）
- [ ] 标签 4：可用配方（调用 `GET /rewards/recipes`）+ 兑换按钮

**验证**：
1. 积分兑换奖品成功，"我的奖品"列表刷新
2. 使用配方兑换，材料数量减少

---

### 3.3 积分系统页面
- [ ] 创建 `pages/6_💰_积分系统.py`
- [ ] 显示积分余额（大号字体）
- [ ] 显示积分流水表格（时间、类型、变化、余额）

**验证**：完成任务后，积分余额增加，流水记录出现新条目

---

## 阶段 4：辅助页面（P2，可并行）

### 4.1 Top3 管理页面
- [ ] 创建 `pages/7_⭐_Top3管理.py`
- [ ] 实现设置 Top3（多选任务 + 提交按钮）
- [ ] 实现查询指定日期 Top3（日期输入框 + 查询按钮）

**验证**：设置 Top3 成功，查询历史正确显示

---

### 4.2 用户管理页面
- [ ] 创建 `pages/8_👤_用户管理.py`
- [ ] 显示个人资料（调用 `GET /users/profile`）
- [ ] 实现反馈提交表单

**验证**：显示用户信息，提交反馈成功

---

## 阶段 5：通用功能和优化（P0）

### 5.1 通用组件
- [ ] 创建 `components/json_viewer.py`：可展开的 JSON 查看器
- [ ] 为所有页面添加"刷新"按钮
- [ ] 统一错误处理：红色提示框 + 完整 JSON

**验证**：API 报错时显示清晰的错误信息

---

### 5.2 文档和配置
- [ ] 编写 `streamlit_app/README.md`：启动指南和功能说明
- [ ] 在根目录 `README.md` 添加测试面板使用说明
- [ ] 配置 `.gitignore`：忽略 Streamlit 缓存文件

**验证**：按照 README 指南，新用户可以成功启动应用

---

## 阶段 6：验收测试（P0）

### 6.1 完整业务流程测试
- [ ] 测试流程：游客初始化 → 创建任务 → 设置 Top3 → 开始专注 → 完成任务 → 兑换奖励
- [ ] 验证每步 API 调用成功，数据正确关联
- [ ] 验证 Token 自动注入，无需手动输入

**验收标准**：
- ✅ 覆盖全部 38 个 API 端点
- ✅ 数据驱动交互（任务/聊天/奖励页面无需手动输入 ID）
- ✅ JWT 自动管理
- ✅ 树形任务视图 + 类微信聊天界面
- ✅ 表格 + JSON 双视图

---

## 依赖关系
- **阶段 1 必须先完成**：其他阶段依赖 API 客户端和状态管理
- **阶段 2-4 可并行开发**：各页面独立
- **阶段 5 贯穿始终**：通用组件在开发过程中持续完善
