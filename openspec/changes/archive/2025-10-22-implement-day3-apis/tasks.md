## 1. 数据模型调整
- [ ] 1.1 修改RewardTransaction模型，字段匹配v3文档（source_type, source_id, transaction_group）
- [ ] 1.2 统一所有source_type枚举值到v3标准
- [ ] 1.3 调整TaskTop3模型，确保与v3文档格式一致
- [ ] 1.4 清理现有数据库，准备重新生成

## 2. 环境配置扩展
- [ ] 2.1 设计.env配置结构，包含奖品、配方、奖励参数
- [ ] 2.2 保留原有LLM配置，添加游戏化配置
- [ ] 2.3 创建配置加载和管理模块
- [ ] 2.4 设计奖品池和抽奖配置

## 3. API响应格式统一
- [ ] 3.1 检查所有现有API端点的响应格式
- [ ] 3.2 创建统一响应格式工具函数
- [ ] 3.3 更新所有API端点使用统一格式
- [ ] 3.4 确保错误响应也符合统一格式

## 4. 任务完成API重构
- [ ] 4.1 移除任务完成API的心情反馈字段
- [ ] 4.2 集成Top3任务判断逻辑（基于v3文档is_top3_task）
- [ ] 4.3 实现v3文档奖励发放机制（普通2分，Top3抽奖）
- [ ] 4.4 实现事务一致性（任务完成→奖励发放→完成度更新）
- [ ] 4.5 更新响应格式包含reward_earned字段

## 5. 奖励系统API实现
- [ ] 5.1 实现GET /rewards/catalog API，从.env加载奖品数据
- [ ] 5.2 实现GET /rewards/my-rewards API，聚合计算用户奖品
- [ ] 5.3 从.env配置初始化奖品池和兑换配方
- [ ] 5.4 实现POST /rewards/redeem API（Day 4功能，Day 3准备数据）

## 6. 积分系统API实现
- [ ] 6.1 实现GET /points/balance API，实时计算余额
- [ ] 6.2 实现GET /points/transactions API，严格按v3分页格式
- [ ] 6.3 确保分页格式包含current_page, total_pages, total_count
- [ ] 6.4 实现积分流水按创建时间倒序排列

## 7. Top3系统API实现
- [ ] 7.1 实现POST /tasks/top3 API，包含300积分消耗
- [ ] 7.2 实现GET /tasks/top3/{date} API，查询指定日期Top3
- [ ] 7.3 实现Top3设置的业务规则（每日一次，无日期限制）
- [ ] 7.4 集成Top3与任务完成逻辑的关联

## 8. 抽奖系统实现
- [ ] 8.1 实现Top3任务的50%抽奖逻辑
- [ ] 8.2 设计简单抽奖奖品池（无权重，无稀有度）
- [ ] 8.3 实现抽奖结果记录到RewardTransaction
- [ ] 8.4 确保抽奖与积分发放的互斥性

## 9. 事务一致性保障
- [ ] 9.1 设计数据库事务边界
- [ ] 9.2 实现任务完成失败时的回滚机制
- [ ] 9.3 实现奖励发放失败时的完整回滚
- [ ] 9.4 添加事务日志和错误处理

## 10. 测试工程设计
- [ ] 10.1 创建test目录下的专门测试工程
- [ ] 10.2 设计测试数据初始化脚本（测试用户、任务、奖品）
- [ ] 10.3 实现API端到端测试用例
- [ ] 10.4 创建数据库清理和重置工具
- [ ] 10.5 实现自动化测试运行脚本

## 11. 系统启动优化
- [ ] 11.1 添加详细的启动日志记录
- [ ] 11.2 实现测试用户自动创建功能
- [ ] 11.3 添加数据初始化成功确认日志
- [ ] 11.4 实现启动失败的详细错误报告

## 12. 集成测试验证
- [ ] 12.1 测试完整任务完成流程
- [ ] 12.2 验证Top3设置和查询功能（包含位置信息）
- [ ] 12.3 测试抽奖机制的正确性
- [ ] 12.4 验证事务一致性和回滚机制
- [ ] 12.5 确保所有API响应格式统一
- [ ] 12.6 验证HTTP标准错误码的使用