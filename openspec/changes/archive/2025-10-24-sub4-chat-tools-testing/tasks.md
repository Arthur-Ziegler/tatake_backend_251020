# 实施任务：完整测试

## 任务列表

### 1. 编写集成测试
- [ ] 创建 `tests/domains/chat/test_task_tools_integration.py`
- [ ] 使用真实数据库（测试fixture）
- [ ] 测试完整调用链（工具→TaskService→数据库）
- [ ] 测试多用户隔离
- [ ] 测试任务树创建
- [ ] 测试批量创建部分成功

### 2. 编写E2E场景测试
- [ ] 创建 `tests/e2e/test_chat_task_management.py`
- [ ] 场景1：创建任务对话
- [ ] 场景2：更新任务对话
- [ ] 场景3：任务拆分对话（多轮）
- [ ] 场景4：任务搜索对话
- [ ] 场景5：批量创建部分失败

### 3. 性能和安全审查
- [ ] Token成本评估
  - 统计各工具的token消耗
  - 文档化成本数据
- [ ] 安全审查
  - 确认所有工具验证user_id
  - 确认UUID转换正确处理异常
  - 确认无SQL注入风险
- [ ] 性能测试
  - 批量创建100个子任务耗时
  - 搜索100个任务耗时
  - 确保响应时间 < 2秒

### 4. 文档更新
- [ ] 更新工具文档字符串
- [ ] 编写使用指南（如需要）
- [ ] 记录常见问题

### 5. 部署准备
- [ ] 运行完整测试套件
- [ ] 验证测试覆盖率 > 85%
- [ ] 准备监控指标
- [ ] 编写回滚方案

## 验证
```bash
uv run pytest tests/ -v --cov=src/domains/chat/tools
```

## 预估工作量
4-5小时
