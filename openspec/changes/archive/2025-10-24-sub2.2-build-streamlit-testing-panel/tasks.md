# Tasks: Streamlit 测试面板独立功能实施

## 前置条件
- ✅ 提案 1（基础架构）必须已完成
- ✅ `api_client` 和 `state_manager` 已可用

## 阶段 1：智能聊天页面（顺序执行）

### 1.1 创建页面和基础布局
- [ ] 创建 `pages/3_💬_智能聊天.py`
- [ ] 使用 `st.columns([3, 7])` 创建两列布局
- [ ] 左侧：会话列表标题
- [ ] 右侧：聊天记录标题

**验证**：打开页面，显示两列布局

---

### 1.2 实现会话列表
- [ ] 加载会话列表：
  - 调用 `GET /api/v1/chat/sessions`
  - 存入 `session_state.chat_sessions`
- [ ] 渲染会话列表：
  - 遍历会话，显示会话标题按钮
  - 点击按钮时设置 `session_state.current_session_id`
- [ ] 添加"创建会话"按钮：
  - 输入会话标题
  - 调用 `POST /api/v1/chat/sessions`
  - 刷新会话列表

**验证**：
1. 查看会话列表
2. 创建新会话，列表更新

---

### 1.3 实现聊天记录展示
- [ ] 如果 `session_state.current_session_id` 存在：
  - 调用 `GET /api/v1/chat/sessions/{id}/messages`
  - 使用 `st.container(height=400)` 创建滚动容器
  - 遍历消息，区分显示：
    - 用户消息：`**👤 你**: {content}`
    - AI 消息：`**🤖 AI**: {content}`

**验证**：点击会话，显示聊天历史

---

### 1.4 实现发送消息
- [ ] 添加输入框：`st.text_input("输入消息")`
- [ ] 添加"发送"按钮：
  - 调用 `POST /api/v1/chat/sessions/{id}/send`
  - 传入 `content: user_input`
  - 使用 `st.rerun()` 刷新界面

**验证**：
1. 发送消息"你好"
2. 聊天记录显示用户消息
3. 等待 AI 回复，显示 AI 消息

---

### 1.5 实现会话切换
- [ ] 点击左侧会话按钮时：
  - 设置 `session_state.current_session_id`
  - 右侧自动加载该会话的聊天历史

**验证**：创建两个会话，切换时聊天记录正确更新

---

## 阶段 2：奖励系统页面（顺序执行）

### 2.1 创建页面和标签页
- [ ] 创建 `pages/5_🎁_奖励系统.py`
- [ ] 使用 `st.tabs` 创建四个标签：
  - "奖品目录"
  - "我的奖品"
  - "我的材料"
  - "可用配方"

**验证**：打开页面，显示四个标签

---

### 2.2 实现奖品目录
- [ ] 在"奖品目录"标签中：
  - 调用 `GET /api/v1/rewards/catalog`
  - 遍历奖品，使用 `st.columns([3, 1, 1])` 布局：
    - 列1：奖品名称
    - 列2：所需积分
    - 列3："兑换"按钮
  - 点击"兑换"按钮：
    - 调用 `POST /api/v1/rewards/exchange/{id}`
    - 显示成功提示

**验证**：查看奖品目录，点击兑换按钮

---

### 2.3 实现我的奖品
- [ ] 在"我的奖品"标签中：
  - 调用 `GET /api/v1/rewards/my-rewards`
  - 使用 `st.dataframe` 显示奖品列表

**验证**：查看我的奖品列表

---

### 2.4 实现我的材料
- [ ] 在"我的材料"标签中：
  - 调用 `GET /api/v1/rewards/materials`
  - 使用 `st.dataframe` 显示材料列表

**验证**：查看我的材料列表

---

### 2.5 实现可用配方
- [ ] 在"可用配方"标签中：
  - 调用 `GET /api/v1/rewards/recipes`
  - 遍历配方，显示配方名称和"兑换"按钮
  - 点击"兑换"按钮：
    - 调用 `POST /api/v1/rewards/recipes/{id}/redeem`
    - 显示成功提示

**验证**：查看可用配方，点击兑换按钮

---

## 阶段 3：积分系统页面（顺序执行）

### 3.1 创建页面和显示余额
- [ ] 创建 `pages/6_💰_积分系统.py`
- [ ] 调用 `GET /api/v1/points/my-points?user_id={user_id}`
- [ ] 使用 `st.metric` 显示积分余额：
  - `label="当前积分"`
  - `value=balance`

**验证**：打开页面，显示积分余额

---

### 3.2 实现积分流水
- [ ] 添加"查看流水"按钮
- [ ] 点击时调用 `GET /api/v1/points/transactions?user_id={user_id}`
- [ ] 使用 `st.dataframe` 显示流水记录

**验证**：点击"查看流水"，显示流水表格

---

## 阶段 4：用户管理页面（顺序执行）

### 4.1 创建页面和显示个人资料
- [ ] 创建 `pages/8_👤_用户管理.py`
- [ ] 调用 `GET /api/v1/users/profile`
- [ ] 使用 `st.json` 显示个人资料

**验证**：打开页面，显示用户信息

---

### 4.2 实现反馈提交
- [ ] 添加反馈表单：
  - `st.text_area("反馈内容")`
  - "提交"按钮
- [ ] 点击"提交"：
  - 调用 `POST /api/v1/users/feedback`
  - 显示成功提示 "反馈提交成功"

**验证**：输入反馈内容，提交成功

---

## 阶段 5：完整验收测试（顺序执行）

### 5.1 完整功能测试
- [ ] 测试聊天流程：
  - 创建会话
  - 发送消息
  - 查看 AI 回复
  - 切换会话
- [ ] 测试奖励流程：
  - 查看奖品目录
  - 积分兑换奖品
  - 查看我的奖品
  - 查看我的材料
  - 使用配方兑换
- [ ] 测试积分流程：
  - 查看积分余额
  - 查看积分流水
- [ ] 测试用户流程：
  - 查看个人资料
  - 提交反馈

**验收标准**：
- ✅ 聊天界面类似微信，可创建会话、发送消息、切换会话
- ✅ 奖励系统可查看奖品目录、兑换奖品、查看材料、使用配方
- ✅ 积分系统可查看余额和流水记录
- ✅ 用户管理可查看资料、提交反馈

---

## 总计任务数：18 个
- 阶段 1：5 个任务（智能聊天页面）
- 阶段 2：5 个任务（奖励系统页面）
- 阶段 3：2 个任务（积分系统页面）
- 阶段 4：2 个任务（用户管理页面）
- 阶段 5：1 个任务（验收测试，含 4 个子流程）
