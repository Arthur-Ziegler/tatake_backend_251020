## Context

基于技术债务分析，当前Task模型缺少"无限层级任务结构"的核心支持。API设计文档明确要求任务树系统，但现有实现只有基础的parent_id关系，缺少层级深度、路径管理和完成度计算能力。

## Goals / Non-Goals

- **Goals**:
  - 实现完整的无限层级任务结构支持
  - 提供高效的树查询和操作能力
  - 实现基于叶子节点的完成度计算
  - 支持循环引用检测和防护
  - 保持API兼容性，渐进式增强

- **Non-Goals**:
  - 不修改现有API的端点定义
  - 不引入新的外部依赖
  - 不实现复杂的性能优化（按KISS原则）
  - 不涉及Top3任务管理功能（后续单独实现）

## Decisions

- **Decision**: 渐进式模型扩展
  - 在现有Task模型基础上添加新字段
  - 保持现有CRUD API的兼容性
  - 自动计算树结构相关字段，不暴露给用户

- **Decision**: 基于叶子节点的完成度算法
  - 使用简单的数量统计：完成度 = (已完成叶子数 / 总叶子数) × 100%
  - 避免复杂的权重计算，保持简单可预测

- **Decision**: 路径使用任务ID格式
  - path = "/uuid1/uuid2/uuid3" 格式
  - 便于前缀查询和树遍历
  - 避免标题变更带来的路径不一致问题

- **Decision**: 数据库重建策略
  - 使用DROP TABLE重建，避免复杂的数据迁移
  - 简化实现，减少出错可能

## Risks / Trade-offs

- **风险**: 数据库重建导致现有数据丢失
  - **缓解**: 用户明确要求"直接删掉"，接受此风险

- **权衡**: path字段增加存储开销但提升查询性能
  - **决策**: 保留path字段，符合API设计文档要求

- **权衡**: 简化完成度算法 vs 精确性
  - **决策**: 选择基于叶子节点数量的算法，简单且满足需求

- **风险**: 树结构操作的递归深度问题
  - **缓解**: 实现合理的深度限制和循环检测

## Migration Plan

1. **准备阶段**
   - 备份当前Task模型代码
   - 创建新字段定义脚本

2. **实施阶段**
   - 扩展Task模型，添加新字段
   - 更新数据库初始化脚本
   - 实现业务逻辑方法
   - 扩展Repository和Service层

3. **测试阶段**
   - 编写单元测试验证新功能
   - 集成测试验证完整流程
   - 性能测试确保基本可用性

4. **验证阶段**
   - 运行完整测试套件
   - 验证API响应格式
   - 确认与spec要求一致

## Open Questions

- 新字段的默认值设置是否合理？
- 完成度计算是否需要考虑部分完成状态？
- 是否需要设置最大递归深度限制？