# Top3管理 API

## 目录

- [1. 设置Top3任务](#1-设置top3任务)
- [2. 获取Top3任务](#2-获取top3任务)
- [3. 获取指定日期Top3任务（备用接口）](#3-获取指定日期top3任务备用接口)

---

## 1. 设置Top3任务

**POST** `/tasks/special/top3`

**功能描述**: 设置每日Top3重要任务，免费设置。

**业务规则**:
- 每天只能设置一次Top3任务
- 必须选择1-3个任务
- 免费设置，不消耗积分
- 只有完成Top3任务才能参与抽奖
- 任务ID必须是有效的UUID格式
- 必须是用户自己的任务

**认证**: 【必需】需要Bearer Token

**请求参数**:
```json
{
  "date": "string",         // 【必填】目标日期，格式YYYY-MM-DD
  "task_ids": ["string"]    // 【必填】任务ID列表，1-3个UUID
}
```

**字段要求**:
- `date`: 【必填】日期字符串，格式：`YYYY-MM-DD`
- `task_ids`: 【必填】字符串数组，最小长度1，最大长度3，每个元素必须是有效的UUID格式

**验证规则**:
- `date`必须是有效的日期格式
- `task_ids`数组长度必须在1-3之间
- 每个`task_id`必须是有效的UUID格式
- 任务必须属于当前用户
- 任务状态必须是`pending`或`in_progress`

**响应格式**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "date": "string",         // 设置的日期
    "task_ids": ["string"],   // Top3任务ID列表
    "points_consumed": 0,     // 消耗积分（固定为0）
    "created_at": "string",   // 创建时间
    "tasks": [                // 任务详细信息
      {
        "id": "string",
        "title": "string",
        "priority": "string",
        "status": "string"
      }
    ]
  }
}
```

**错误响应**:
- `400`: 无效的UUID格式
- `404`: 任务不存在
- `409`: 该日期已设置Top3任务
- `422`: 请求参数验证失败

---

## 2. 获取Top3任务

**GET** `/tasks/special/top3/{query_date}`

**功能描述**: 获取Top3任务 - 微服务代理（路径重写）
获取用户指定日期的Top3任务列表。

**认证**: 【必需】需要Bearer Token

**路径参数**:
- `query_date`: 【必填】查询日期，格式：YYYY-MM-DD

**查询参数**: 无

**字段要求**:
- `query_date`: 【必填】日期字符串，格式：`YYYY-MM-DD`

**响应格式**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "date": "string",         // 查询的日期
    "task_ids": ["string"],   // Top3任务ID列表
    "points_consumed": 0,     // 消耗积分
    "created_at": "string",   // 创建时间
    "updated_at": "string",   // 更新时间
    "tasks": [                // 任务详细信息
      {
        "id": "string",
        "title": "string",
        "priority": "string",
        "status": "string",
        "completion_percentage": "number",
        "due_date": "string|null"
      }
    ],
    "completion_status": {     // 完成状态统计
      "completed": "integer",  // 已完成数量
      "total": "integer",      // 总数量
      "percentage": "number"   // 完成百分比
    }
  }
}
```

**错误响应**:
- `400`: 日期格式无效
- `404`: 该日期未设置Top3任务

---

## 3. 获取指定日期Top3任务（备用接口）

**GET** `/tasks/special/top3/{date}`

**功能描述**: 获取用户指定日期的Top3任务列表。

**认证**: 【必需】需要Bearer Token

**查询参数**:
- `date_str`: 【必填】查询日期，格式：YYYY-MM-DD

**业务规则**:
- 返回指定日期设置的Top3任务
- 如果当天未设置Top3，返回空列表
- 显示消耗的积分和设置时间

**响应格式**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "date": "2025-01-15",
    "task_ids": ["550e8400-e29b-41d4-a716-446655440000"],
    "points_consumed": 0,
    "created_at": "2025-01-15T10:30:00Z"
  }
}
```

**错误响应**:
- `400`: 日期格式错误，返回"日期格式无效，请使用YYYY-MM-DD格式"

---

*文档最后更新时间: 2025-01-07*
*基于OpenAPI 3.1.0规范*