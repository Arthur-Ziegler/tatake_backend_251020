# 奖励系统 API

## 目录

- [1. 查看我的奖品](#1-查看我的奖品)
- [2. 查看我的积分](#2-查看我的积分)
- [3. 充值界面（兑换奖品）](#3-充值界面兑换奖品)

---

## 1. 查看我的奖品

**GET** `/rewards/prizes`

**功能描述**: 查看我的奖品 - 微服务代理
获取用户的所有奖品记录，包括已领取和未领取的奖品。

**认证**: 【必需】需要Bearer Token

**查询参数**: 无

**响应格式**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "prizes": [
      {
        "id": "string",          // 奖品ID
        "name": "string",        // 奖品名称
        "description": "string", // 奖品描述
        "type": "string",        // 奖品类型
        "value": "integer",      // 奖品价值
        "status": "string",      // 状态：已领取、未领取、已过期
        "redeemed_at": "string|null", // 兑换时间
        "expires_at": "string|null",   // 过期时间
        "source": "string",      // 获得来源
        "obtained_at": "string"  // 获得时间
      }
    ],
    "summary": {
      "total_prizes": "integer",    // 奖品总数
      "redeemed_prizes": "integer", // 已兑换奖品数
      "pending_prizes": "integer",  // 待兑换奖品数
      "expired_prizes": "integer"   // 已过期奖品数
    }
  }
}
```

---

## 2. 查看我的积分

**GET** `/rewards/points`

**功能描述**: 查看我的积分 - 微服务代理
获取用户的积分余额和积分历史记录。

**认证**: 【必需】需要Bearer Token

**查询参数**: 无

**响应格式**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "current_balance": "integer",  // 当前积分余额
    "total_earned": "integer",     // 累计获得积分
    "total_spent": "integer",      // 累计消费积分
    "level": "string",             // 用户等级
    "next_level_points": "integer", // 下一等级所需积分
    "history": [                   // 积分历史记录
      {
        "id": "string",
        "type": "earn|spend",      // 类型：获得或消费
        "amount": "integer",       // 积分数量
        "reason": "string",        // 原因
        "source": "string",        // 来源
        "timestamp": "string"      // 时间
      }
    ],
    "statistics": {
      "daily_average": "number",   // 日均获得积分
      "weekly_total": "integer",   // 本周获得积分
      "monthly_total": "integer"   // 本月获得积分
    }
  }
}
```

---

## 3. 充值界面（兑换奖品）

**POST** `/rewards/redeem`

**功能描述**: 充值界面（兑换奖品） - 微服务代理
使用兑换码兑换奖品。

**认证**: 【必需】需要Bearer Token

**请求参数**:
```json
{
  "code": "string"  // 【必填】兑换码，长度1-100字符
}
```

**字段要求**:
- `code`: 【必填】兑换码字符串，最小长度1，最大长度100

**验证规则**:
- 兑换码必须是有效且未使用的
- 兑换码不能已过期
- 用户积分必须足够支付相应积分
- 同一个用户不能重复兑换同一个兑换码

**响应格式**:
```json
{
  "code": 200,
  "message": "兑换成功",
  "data": {
    "prize": {
      "id": "string",          // 奖品ID
      "name": "string",        // 奖品名称
      "description": "string", // 奖品描述
      "type": "string",        // 奖品类型
      "value": "integer"       // 奖品价值
    },
    "points_consumed": "integer",   // 消耗积分
    "remaining_balance": "integer", // 剩余积分
    "redeemed_at": "string",        // 兑换时间
    "expiry_date": "string|null"    // 奖品过期时间
  }
}
```

**错误响应**:
- `400`: 兑换码无效或已过期
- `409`: 兑换码已被使用
- `422`: 积分不足

---

*文档最后更新时间: 2025-01-07*
*基于OpenAPI 3.1.0规范*