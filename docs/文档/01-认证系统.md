# 认证系统 API

## 目录

- [1. 微信登录](#1-微信登录)
- [2. 刷新访问令牌](#2-刷新访问令牌)
- [3. 发送手机验证码](#3-发送手机验证码)
- [4. 手机验证码登录](#4-手机验证码登录)

---

## 1. 微信登录

**POST** `/auth/wechat/login`

**功能描述**: 微信登录（自动注册）
自动处理注册和登录流程：
1. 先尝试登录已有用户
2. 如果用户不存在，自动注册新用户
3. 返回Access Token和Refresh Token

**请求参数**:
```json
{
  "wechat_openid": "string"  // 【必填】微信OpenID，长度1-100字符
}
```

**字段要求**:
- `wechat_openid`: 【必填】微信OpenID字符串，最小长度1，最大长度100

**响应格式**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "access_token": "string",    // 访问令牌
    "refresh_token": "string",   // 刷新令牌
    "token_type": "Bearer",      // 令牌类型
    "expires_in": 3600,         // 过期时间（秒）
    "user_id": "string"         // 用户ID
  }
}
```

---

## 2. 刷新访问令牌

**POST** `/auth/token/refresh`

**功能描述**: 使用刷新令牌获取新的访问令牌，支持游客、微信、手机等多种认证方式的令牌刷新

**请求参数**:
```json
{
  "refresh_token": "string"  // 【必填】刷新令牌，最小长度1
}
```

**字段要求**:
- `refresh_token`: 【必填】有效的刷新令牌字符串

**响应格式**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "access_token": "string",    // 新的访问令牌
    "refresh_token": "string",   // 新的刷新令牌
    "token_type": "Bearer",      // 令牌类型
    "expires_in": 3600         // 过期时间（秒）
  }
}
```

---

## 3. 发送手机验证码

**POST** `/auth/phone/send-code`

**功能描述**: 发送手机验证码（智能检测）
智能检测用户状态，自动选择合适的场景：
1. 先尝试发送登录验证码
2. 如果用户不存在，自动切换为注册验证码
3. 返回发送结果和验证码类型

验证码有效期为5分钟，同一手机号有发送频率限制。

**请求参数**:
```json
{
  "phone": "string"  // 【必填】手机号，必须符合中国手机号格式
}
```

**字段要求**:
- `phone`: 【必填】手机号，格式：`1[3-9]xxxxxxxxx`（11位数字，第二位3-9）

**验证规则**:
- 必须符合正则表达式：`^1[3-9]\d{9}$`

**响应格式**:
```json
{
  "code": 200,
  "message": "验证码发送成功",
  "data": {
    "type": "login|register",    // 验证码类型：登录或注册
    "expires_in": 300,           // 过期时间（秒）
    "phone": "13800138000",      // 发送的手机号
    "code": "452911"             // 本次发送的验证码（实际业务可视情况返回，为了测试需要返回）
  }
}
```

> 注：出于测试需求，接口会返回本次发送的验证码字段 `code`，正式环境可根据安全策略选择不返回该字段。

---

## 4. 手机验证码登录

**POST** `/auth/phone/verify`

**功能描述**: 手机验证码登录（智能检测）
智能检测用户状态，自动选择合适的验证场景：
1. 先尝试登录验证
2. 如果用户不存在，自动切换为注册验证
3. 返回认证Token信息

**请求参数**:
```json
{
  "phone": "string",  // 【必填】手机号，必须符合中国手机号格式
  "code": "string"    // 【必填】验证码，6位数字
}
```

**字段要求**:
- `phone`: 【必填】手机号，格式：`1[3-9]xxxxxxxxx`
- `code`: 【必填】6位数字验证码

**验证规则**:
- `phone`: 必须符合正则表达式：`^1[3-9]\d{9}$`
- `code`: 必须符合正则表达式：`^\d{6}$`

**响应格式**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "access_token": "string",    // 访问令牌
    "refresh_token": "string",   // 刷新令牌
    "token_type": "Bearer",      // 令牌类型
    "expires_in": 3600,         // 过期时间（秒）
    "user_id": "string"         // 用户ID
  }
}
```

---
