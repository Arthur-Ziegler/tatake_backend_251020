# 用户管理 API

## 目录

- [1. 获取用户信息](#1-获取用户信息)
- [2. 更新用户信息](#2-更新用户信息)

---

## 1. 获取用户信息

**GET** `/user/profile`

**功能描述**: 获取当前用户信息
包含完整的用户资料信息、偏好设置和积分余额。直接查询主数据库，确保用户数据可以正确获取。

**认证**: 【必需】需要Bearer Token

**响应格式**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "string",                    // 【必返回】用户ID（UUID格式）
    "nickname": "string",              // 【必返回】用户昵称
    "avatar": "string|null",          // 【可选】头像URL
    "bio": "string|null",             // 【可选】用户简介
    "wechat_openid": "string|null",   // 【可选】微信OpenID
    "is_guest": "boolean",            // 【必返回】是否为游客
    "is_active": "boolean",           // 【必返回】是否激活
    "created_at": "string",           // 【必返回】创建时间（ISO格式）
    "last_login_at": "string|null",   // 【可选】最后登录时间
    "gender": "string|null",          // 【可选】性别：male, female, other
    "birthday": "string|null",        // 【可选】生日（ISO格式：YYYY-MM-DD）
    "theme": "string",                // 【必返回】主题：light, dark, auto, system
    "language": "string",             // 【必返回】语言：zh-CN, en-US等
    "points_balance": "integer",      // 【必返回】积分余额
    "stats": "object|null"           // 【可选】用户统计信息
  }
}
```

**返回字段详细说明**:
- `id`: 用户唯一标识符，UUID格式
- `nickname`: 用户昵称，必填字段
- `avatar`: 用户头像URL，可能为null
- `bio`: 用户个人简介，最多500字符，可能为null
- `wechat_openid`: 微信OpenID，可能为null
- `is_guest`: 是否为游客用户，默认false
- `is_active`: 账户是否激活，默认true
- `created_at`: 账户创建时间，ISO 8601格式
- `last_login_at`: 最后登录时间，ISO 8601格式，可能为null
- `gender`: 用户性别，枚举值：male, female, other，可能为null
- `birthday`: 用户生日，格式：YYYY-MM-DD，可能为null
- `theme`: 用户界面主题，默认为light
- `language`: 用户语言偏好，默认为zh-CN
- `points_balance`: 当前积分余额，整数，默认为0
- `stats`: 用户统计信息对象，包含登录次数、完成任务数等，可能为null

---

## 2. 更新用户信息

**PUT** `/user/profile`

**功能描述**: 更新用户信息
支持更新基础用户信息、个人信息和偏好设置。包含事务性更新，确保数据一致性。

**认证**: 【必需】需要Bearer Token

**请求参数**:
```json
{
  "nickname": "string",        // 【可选】用户昵称，长度1-50字符
  "avatar_url": "string",      // 【可选】头像URL
  "bio": "string",            // 【可选】用户简介，最大500字符
  "gender": "string",         // 【可选】性别：male, female, other
  "birthday": "string",       // 【可选】生日（ISO格式：YYYY-MM-DD）
  "theme": "string",          // 【可选】主题：light, dark, auto, system
  "language": "string"        // 【可选】语言：zh-CN, en-US等
}
```

**字段要求**:
- 所有字段都是【可选】的，支持部分更新
- `nickname`: 字符串，最小长度1，最大长度50
- `avatar_url`: 有效的URL字符串
- `bio`: 字符串，最大长度500
- `gender`: 枚举值：`male`, `female`, `other`
- `birthday`: 日期格式：`YYYY-MM-DD`
- `theme`: 枚举值：`light`, `dark`, `auto`, `system`
- `language`: 语言代码，如：`zh-CN`, `en-US`

**响应格式**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "updated_fields": ["nickname", "avatar"], // 更新的字段列表
    "user_id": "string"                     // 用户ID等更新过后的数据结果
  }
}
```

---

