2025-10-26 02:09:52,712 - src.domains.chat.context_manager - INFO - ä¸Šä¸‹æ–‡ç®¡ç†å™¨åˆå§‹åŒ–: max_messages=20, max_tokens=None
2025-10-26 02:09:52,712 - src.domains.chat.database - INFO - èŠå¤©å†…å­˜å­˜å‚¨åˆ›å»ºæˆåŠŸ
2025-10-26 02:09:52,712 - __main__ - INFO - ğŸ”§ ChatServiceçŒ´å­è¡¥ä¸å·²åº”ç”¨
2025-10-26 02:09:52,793 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-10-26 02:09:52,793 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-10-26 02:09:52,793 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-10-26 02:09:52,813 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auth")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auth_audit_logs")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("tasks")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("points_transactions")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("rewards")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("reward_recipes")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("reward_transactions")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("task_top3")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("focus_sessions")
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,814 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-10-26 02:09:52,814 - src.domains.task.database - INFO - Taské¢†åŸŸæ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
2025-10-26 02:09:52,814 - src.domains.task.database - INFO - Taské¢†åŸŸæ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
2025-10-26 02:09:52,815 - src.domains.reward.database - INFO - å¼€å§‹åˆå§‹åŒ–å¥–åŠ±ç³»ç»Ÿæ•°æ®åº“
2025-10-26 02:09:52,815 - src.domains.reward.database - INFO - å¼€å§‹åˆå§‹åŒ–å¥–å“æ•°æ®
2025-10-26 02:09:52,815 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-10-26 02:09:52,817 - sqlalchemy.engine.Engine - INFO - SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-26 02:09:52,817 - sqlalchemy.engine.Engine - INFO - [generated in 0.00007s] ('å°é‡‘å¸',)
2025-10-26 02:09:52,817 - src.domains.reward.database - DEBUG - å¥–å“å·²å­˜åœ¨ï¼Œè·³è¿‡: å°é‡‘å¸
2025-10-26 02:09:52,818 - sqlalchemy.engine.Engine - INFO - SELECT rewards.id, rewards.name, rewards.description, rewards.points_value, rewards.image_url, rewards.cost_type, rewards.cost_value, rewards.stock_quantity, rewards.category, rewards.is_active, rewards.created_at, rewards.updated_at 
FROM rewards 
WHERE rewards.name = ?
2025-10-26 02:09:52,818 - sqlalchemy.engine.Engine - INFO - [cached since 0.0004713s ago] ('é’»çŸ³',)
2025-10-26 02:09:52,818 - src.domains.reward.database - DEBUG - å¥–å“å·²å­˜åœ¨ï¼Œè·³è¿‡: é’»çŸ³
2025-10-26 02:09:52,818 - src.domains.reward.database - INFO - å¥–å“åˆå§‹åŒ–å®Œæˆï¼Œæ–°åˆ›å»º 0 ä¸ªå¥–å“
2025-10-26 02:09:52,818 - src.domains.reward.database - INFO - å¼€å§‹åˆå§‹åŒ–é…æ–¹æ•°æ®
2025-10-26 02:09:52,818 - sqlalchemy.engine.Engine - INFO - SELECT reward_recipes.id, reward_recipes.name, reward_recipes.result_reward_id, reward_recipes.materials, reward_recipes.is_active, reward_recipes.created_at, reward_recipes.updated_at 
FROM reward_recipes 
WHERE reward_recipes.name = ?
2025-10-26 02:09:52,818 - sqlalchemy.engine.Engine - INFO - [generated in 0.00005s] ('å°é‡‘å¸åˆæˆé’»çŸ³',)
2025-10-26 02:09:52,818 - src.domains.reward.database - DEBUG - é…æ–¹å·²å­˜åœ¨ï¼Œè·³è¿‡: å°é‡‘å¸åˆæˆé’»çŸ³
2025-10-26 02:09:52,818 - src.domains.reward.database - INFO - é…æ–¹åˆå§‹åŒ–å®Œæˆï¼Œæ–°åˆ›å»º 0 ä¸ªé…æ–¹
2025-10-26 02:09:52,818 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-10-26 02:09:52,818 - src.domains.reward.database - INFO - å¥–åŠ±ç³»ç»Ÿæ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
2025-10-26 02:09:52,819 - src.domains.chat.database - INFO - èŠå¤©æ•°æ®åº“è¿æ¥æ­£å¸¸
2025-10-26 02:09:52,819 - src.domains.chat.database - INFO - èŠå¤©æ£€æŸ¥ç‚¹å™¨åˆ›å»ºæˆåŠŸ: /Users/zalelee/Code/tatake_backend/data/chat.db
2025-10-26 02:09:52,819 - src.domains.chat.database - INFO - æ£€æŸ¥ç‚¹å™¨éªŒè¯é€šè¿‡: /Users/zalelee/Code/tatake_backend/data/chat.db
2025-10-26 02:09:52,819 - src.domains.chat.database - INFO - èŠå¤©æ•°æ®åº“è¿æ¥æ­£å¸¸
2025-10-26 02:09:52,819 - src.domains.chat.database - INFO - èŠå¤©æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auth")
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auth_audit_logs")
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("tasks")
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("points_transactions")
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("rewards")
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("reward_recipes")
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("reward_transactions")
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("task_top3")
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("focus_sessions")
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-10-26 02:09:52,820 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-10-26 02:09:52,820 - src.domains.focus.database - INFO - Focusé¢†åŸŸæ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
2025-10-26 02:10:00,506 - src.domains.auth.repository - INFO - Auto-generated user_id: e589b4d6-8ee2-4bff-b82d-630b65f451d5
2025-10-26 02:10:00,510 - src.domains.auth.repository - INFO - Created user: e589b4d6-8ee2-4bff-b82d-630b65f451d5, is_guest: True
2025-10-26 02:10:00,512 - src.domains.auth.repository - ERROR - Invalid user_id type in audit log: <class 'str'>, value: e589b4d6-8ee2-4bff-b82d-630b65f451d5
2025-10-26 02:10:00,514 - src.domains.auth.repository - INFO - Created audit log: a5aac74c-0072-4025-9d1c-cc00e2a73d5e, user_id: e589b4d6-8ee2-4bff-b82d-630b65f451d5, action: guest_init, result: success
2025-10-26 02:10:00,522 - src.domains.chat.router - INFO - åˆ›å»ºèŠå¤©ä¼šè¯è¯·æ±‚: user_id=e589b4d6-8ee2-4bff-b82d-630b65f451d5, title=è°ƒè¯•æµ‹è¯•ä¼šè¯
2025-10-26 02:10:00,522 - src.domains.chat.database - INFO - èŠå¤©æ£€æŸ¥ç‚¹å™¨åˆ›å»ºæˆåŠŸ: /Users/zalelee/Code/tatake_backend/data/chat.db
2025-10-26 02:10:00,522 - src.domains.chat.database - INFO - æ£€æŸ¥ç‚¹å™¨éªŒè¯é€šè¿‡: /Users/zalelee/Code/tatake_backend/data/chat.db
2025-10-26 02:10:00,523 - src.domains.chat.service - DEBUG - ä¼šè¯è®°å½•å·²åˆ›å»º: session_id=9335feba-cf24-46b4-96b5-aa1a0f185197, user_id=e589b4d6-8ee2-4bff-b82d-630b65f451d5
2025-10-26 02:10:00,523 - src.domains.chat.service - INFO - èŠå¤©ä¼šè¯åˆ›å»ºæˆåŠŸ: user_id=e589b4d6-8ee2-4bff-b82d-630b65f451d5, session_id=9335feba-cf24-46b4-96b5-aa1a0f185197
2025-10-26 02:10:00,524 - src.domains.chat.router - INFO - èŠå¤©ä¼šè¯åˆ›å»ºæˆåŠŸ: user_id=e589b4d6-8ee2-4bff-b82d-630b65f451d5, session_id=9335feba-cf24-46b4-96b5-aa1a0f185197
2025-10-26 02:10:00,532 - src.utils.api_validators - DEBUG - session_idéªŒè¯é€šè¿‡: 9335feba-cf24-46b4-96b5-aa1a0f185197
2025-10-26 02:10:00,532 - src.domains.chat.router - INFO - å‘é€èŠå¤©æ¶ˆæ¯è¯·æ±‚: user_id=e589b4d6-8ee2-4bff-b82d-630b65f451d5, session_id=9335feba-cf24-46b4-96b5-aa1a0f185197
2025-10-26 02:10:00,532 - __main__ - INFO - ğŸš€ å¼€å§‹å‘é€æ¶ˆæ¯: user_id=e589b4d6-8ee2-4bff-b82d-630b65f451d5, session_id=9335feba-cf24-46b4-96b5-aa1a0f185197, message='è°ƒè¯•æµ‹è¯•æ¶ˆæ¯'
2025-10-26 02:10:00,532 - src.domains.chat.database - INFO - èŠå¤©æ£€æŸ¥ç‚¹å™¨åˆ›å»ºæˆåŠŸ: /Users/zalelee/Code/tatake_backend/data/chat.db
2025-10-26 02:10:00,532 - src.domains.chat.database - INFO - æ£€æŸ¥ç‚¹å™¨éªŒè¯é€šè¿‡: /Users/zalelee/Code/tatake_backend/data/chat.db
2025-10-26 02:10:00,533 - __main__ - DEBUG - ğŸ”§ åˆ›å»ºTypeSafeCheckpointeråŒ…è£…å™¨
2025-10-26 02:10:00,533 - __main__ - DEBUG - ğŸ“‹ Base checkpointerç±»å‹: <class 'langgraph.checkpoint.sqlite.SqliteSaver'>
2025-10-26 02:10:00,533 - __main__ - DEBUG - âœ… TypeSafeCheckpointeråˆ›å»ºæˆåŠŸ: <class 'src.domains.chat.service.ChatService._create_type_safe_checkpointer.<locals>.TypeSafeCheckpointer'>
2025-10-26 02:10:00,533 - src.domains.chat.service - DEBUG - ä½¿ç”¨checkpointeråˆ›å»ºGraphå®ä¾‹
2025-10-26 02:10:00,536 - src.domains.chat.graph - INFO - âœ… èŠå¤©å›¾æ„å»ºæˆåŠŸï¼ˆåŸºäºæœ€ä½³å®è·µï¼‰
2025-10-26 02:10:00,536 - src.domains.chat.graph - INFO - èŠå¤©å›¾å®ä¾‹åˆ›å»ºæˆåŠŸ
2025-10-26 02:10:00,536 - src.domains.chat.service - ERROR - âŒ æ¶ˆæ¯å‘é€å¤±è´¥: user_id=e589b4d6-8ee2-4bff-b82d-630b65f451d5, session_id=9335feba-cf24-46b4-96b5-aa1a0f185197, error='>' not supported between instances of 'str' and 'int'
2025-10-26 02:10:00,536 - __main__ - ERROR - âŒ æ¶ˆæ¯å‘é€å¤±è´¥: å‘é€æ¶ˆæ¯å¤±è´¥: '>' not supported between instances of 'str' and 'int'
2025-10-26 02:10:00,539 - __main__ - ERROR - ğŸ” å®Œæ•´é”™è¯¯å †æ ˆ:
Traceback (most recent call last):
  File "/Users/zalelee/Code/tatake_backend/src/domains/chat/service.py", line 449, in send_message
    result = self._with_checkpointer(_send_with_checkpointer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zalelee/Code/tatake_backend/src/domains/chat/service.py", line 112, in _with_checkpointer
    return func(safe_checkpointer)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zalelee/Code/tatake_backend/src/domains/chat/service.py", line 445, in _send_with_checkpointer
    result = temp_graph.graph.invoke(current_state, config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zalelee/Code/tatake_backend/.venv/lib/python3.12/site-packages/langgraph/pregel/main.py", line 3094, in invoke
    for chunk in self.stream(
                 ^^^^^^^^^^^^
  File "/Users/zalelee/Code/tatake_backend/.venv/lib/python3.12/site-packages/langgraph/pregel/main.py", line 2615, in stream
    with SyncPregelLoop(
         ^^^^^^^^^^^^^^^
  File "/Users/zalelee/Code/tatake_backend/.venv/lib/python3.12/site-packages/langgraph/pregel/_loop.py", line 1084, in __enter__
    self.updated_channels = self._first(
                            ^^^^^^^^^^^^
  File "/Users/zalelee/Code/tatake_backend/.venv/lib/python3.12/site-packages/langgraph/pregel/_loop.py", line 704, in _first
    self._put_checkpoint({"source": "input"})
  File "/Users/zalelee/Code/tatake_backend/.venv/lib/python3.12/site-packages/langgraph/pregel/_loop.py", line 757, in _put_checkpoint
    new_versions = get_new_channel_versions(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zalelee/Code/tatake_backend/.venv/lib/python3.12/site-packages/langgraph/pregel/_utils.py", line 28, in get_new_channel_versions
    if v > previous_versions.get(k, null_version)  # type: ignore[operator]
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '>' not supported between instances of 'str' and 'int'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/zalelee/Code/tatake_backend/debug_real_time_error.py", line 41, in debug_send_message
    result = original_send_message(self, user_id, session_id, message)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zalelee/Code/tatake_backend/src/domains/chat/service.py", line 469, in send_message
    raise Exception(f"å‘é€æ¶ˆæ¯å¤±è´¥: {str(e)}")
Exception: å‘é€æ¶ˆæ¯å¤±è´¥: '>' not supported between instances of 'str' and 'int'

2025-10-26 02:10:00,539 - __main__ - ERROR - ğŸš¨ ç¡®è®¤æ˜¯ç±»å‹æ¯”è¾ƒé”™è¯¯ï¼
2025-10-26 02:10:00,539 - __main__ - ERROR - ğŸ”§ æ£€æŸ¥checkpointerçŠ¶æ€...
2025-10-26 02:10:00,539 - __main__ - INFO - âœ… db_managerå­˜åœ¨
2025-10-26 02:10:00,539 - src.domains.chat.router - ERROR - å‘é€èŠå¤©æ¶ˆæ¯å¤±è´¥: user_id=e589b4d6-8ee2-4bff-b82d-630b65f451d5, session_id=9335feba-cf24-46b4-96b5-aa1a0f185197, error=å‘é€æ¶ˆæ¯å¤±è´¥: '>' not supported between instances of 'str' and 'int'
